
    БИС КОНТРОЛЛЕРА КР1818ВГ93 ДЛЯ НАКОПИТЕЛЯ НА ГИБКОМ ДИСКЕ

    Микросхема КР1818ВГ93 представляет собой  однокристальное  программи-
руемое устройство, предназначенное для управления выводом  информации  из
ЭВМ на гибкие магнитные диски и вводом информации  из  НГМД  в  ЭВМ.  БИС
обеспечивает программирование номеров дорожки, сектора и стороны диска, а
также длины сектора, режимов поиска дорожки и установки (МГ)  в  исходное
положение, режимов чтения или записи информации, скорости перемещения МГ.
    Контроллер КР1818ВГ93 позволяет организовать автоматический  контроль
считываемой и записываемой информации по контрольному коду (КК), записан-
ному в конце индексного  и  информационного  массивов.  Индексный  массив
включает адресную метку, номер сектора, длину сектора,  номер  дорожки  и
номер стороны диска. Информационный массив  содержит  метку  и  непосред-
ственно данные.
    В режиме записи микросхема обеспечивает выдачу сигналов предкомпенса-
ции записи в зависимости от кодов, представляющих информацию.  Вывод  ин-
формации из ЭВМ выполняется по сигналу Запрос данных,  формируемому  мик-
росхемой, а считывание определяется сигналами Готовность и Индексный  им-
пульс, выдаваемые аппаратурной логикой НГМД. Технические данные и  харак-
теристики при Т = -10...70°С, Uсс = 5В +/- 5% и 12В +/- 5% и  токах  пот-
ребления 60 и 20 мА приведены ниже.

    Электрические параметры микросхемы

    Входное напряжение высокого уровня, В, не менее ............. 2,6
    Входное напряжение низкого уровня, В, не более .............. 0,8
    Выходное напряжение высокого уровня, В, не менее ............ 2,8
    Выходное напряжение низкого уровня, В, не более ............ 0,45
    Выходной ток высокого уровня, мА, не более ................ -0,15
    Выходной ток низкого уровня, мА, не более ................... 1,9
    Емкость нагрузки по входам, пФ, не более .................... 100
    Максимальная потребляемая мощность, мВт, не более ........... 500

    Обмен нформацией с ЭВМ происходит по 8-разрядной двунаправленной  ши-
не данных. Запись информации на ГМД осуществляется с  одинарной  или  уд-
военной плотностью. Под одинарной плотностью подразумевается  запись  ин-
формации с частотной модуляцией (рис. 1), а под удвоенной - запись инфор-
мации с модифицированной модуляцией (рис. 2). Микросхема обеспечивает ра-
боту с ГМД размером 133 или 203 мм (по длине  стороны  конверта).  Макси-
мальное программируемое число дорожек на ГМД  -  256.  Максимальная  ско-
рость обмена информацией при одинарной плотности  записи  составляет  250
Кбит/с, при удвоенной плотности записи -  500  Кбит/с.  Тактовая  частота
внешнего генератора равна 1 МГц для ГМД размером 133 мм и 2 МГц  для  ГМД
размером 203 мм.  Микросхема  выполнена  в  40-выводном  корпусе  типа  2
123.40-2. Назначение выводов БИС КР1818ВГ93 показано в табл. 1.

   │         │         │       │         │       │           │      │
Код│         │         │       │         │       │           │      │
за-│         │         │       │         │       │           │      │
пи-│    1    │    1    │   0   │    1    │   0   │     1     │   0  │
си │         │         │       │         │       │           │      │
WD │         │         │       │         │       │           │      │
   │         │         │       │         │       │           │      │
   ┌──┐ ┌──┐ ┌──┐ ┌──┐ ┌──┐    ┌──┐ ┌──┐ ┌──┐    ┌──┐   ┌──┐ ┌──┐   ┌──┐
 __│  │_│  │_│  │_│  │_│  │____│  │_│  │_│  │____│  │___│  │_│  │___│  │_
            \   \ 
 __│_________\___\_____│_______│_________│_______│___________│______│____
  0│  4 мкс  │\   \                                                     t
 __│_________│_\ D \ S
   │         │  ─── ───

       Рис. 1. Режим записи с частотной модуляцией при fclc=2 МГц.

   │         │        │       │        │      │       │        │      │
Код│         │        │       │        │      │       │        │      │
за-│         │        │       │        │      │       │        │      │
пи-│    1    │   1    │   0   │   1    │  0   │   0   │   1    │  0   │
си │         │        │       │        │      │       │        │      │
WD │         │        │       │        │      │       │        │      │
   │         │        │       │        │      │       │        │      │
   │   ┌──┐  │  ┌──┐  │       │  ┌──┐  │      ┌──┐    │  ┌──┐  │      │
 __│___│  │__│__│  │__│_______│__│  │__│______│  │____│__│  │__│______│__
   │        \│        │       │        │         \    │        │      │
 __│_________\________│_______│________│______│___\___│________│______│__
  0│  2 мкс  │\                                    \                    t
 __│_________│_\ D                                  \ S
   │         │  ───                                  ───

    Рис. 2. Режим записи с модифицированной частотной модуляцией при
            fclc=2 МГц: S - синхросигнал, D - импульс данных.

    Выводы 33, 38, 39 микросхемы - выходы с открытым  истоком,  требующие
подключения к источнику питания Ucc1 через резисторы номиналом 10 кОм +/-
10%. Назначение внутренних регистров БИС, выбираемых с  помощью  адресных
сигналов А0, А1, следующее:

    регистр данных (РгД) и регистр сдвиговый (РгСдв) - для  приема,  хра-
    нения и преобразования данных;

    регистр сектора (РгСект) - для хранения  информации о  номере  считы-
    ваемого (записываемого) сектора;

    регистр дорожки (РгДор) - для записи  номера  требуемой  дорожки  или
    хранения информации о номере дорожки, на которой находится МГ;

    регистр команд (РгКом) - для записи текущей выполняемой команды;

    регистр состояния (РгСост) - для определения текущего состояния  раз-
    личных функциональных узлов микросхемы и НГМД.

    Функциональное назначение каждого разряда РгСост при выполнении соот-
ветствующих   команд   приведено   в   табл.   2   (указанным   признакам
соответствует "Лог. 1" в РгСост).

                    Назначение выводов БИС КР1818ВГ93

                                                              Таблица 1
  ───────┬─────────────┬───────────────────────────────────────────────
   Вывод │ Обозначение │             Выполняемая операция
  ───────┼─────────────┼───────────────────────────────────────────────
     1   │      2      │                      3
  ───────┼─────────────┼───────────────────────────────────────────────
     1   │     BS      │ Вывод микросхемы не подключается. Предназначен
         │             │ для контроля уровня напряжения  смещения  под-
         │     _       │ ложки.
     2   │     W       │ Разрешение записи информации с  шины данных  в
         │     __      │ выбранный регистр.
     3   │     CS      │ Выбор микросхемы, разрешает связь ЭВМ с микро-
         │     _       │ схемой.
     4   │     R       │ Разрешение чтения, обеспечивает вывод информа-
         │             │ ции  из  выбранного  регистра  на  шину данных
         │             │ DB0...DB7.
   5, 6  │   A0, A1    │ Адресная шина. Код на этой шине определяет вы-
         │             │ бор соответствующего регистра для приема  (пе-
         │             │ редачи) информации с (на) шины данных, как по-
         │             │ казано ниже.
         │             │
         │             │   A1   A0   Чтение   Запись
         │             │    0    0   РгСост   PгКом
         │             │    0    1   РгДор    РгДор
         │             │    1    0   РгСект   РгСект
         │             │    1    1   РгД      РгД
         │             │
  7...14 │  DB0...DB7  │ 8-разрядная двунаправленная шина данных.
         │             │
    15   │    STEP     │ Выходной импульс для перемещения МГ
         │             │ на один шаг.
    16   │    DIRC     │ Сигнал,  указывающий  направление  перемешения
         │             │ МГ: высокий - к центру ГМД; низкий - от центра
    17   │     SL      │ Выходной сигнал, указывающий, что импульс дан-
         │             │ ных WD должен быть сдвинут влево.
    18   │     SR      │ Выходной сигнал, указывающий, что импульс дан-
         │    ___      │ ных WD должен быть сдвинут вправо.
    19   │    CLR      │ Сброс обозначает установку микросхемы в исход-
         │             │ ное состояние и запись кода  0000 0011  в  ре-
         │             │ гистр команд. На выходе 39 (INTRQ)  устанавли-
         │             │ вается низкий уровень напряжения. По окончании
         │             │ действия сигнала CLR выполняется команда  ВОС-
         │             │ СТАНОВЛЕНИЕ, независимо от готовности НГМД.
         │             │ Кроме того, записывается код  0000  0001 в ре-
         │             │ гистр сектора.
    20   │    GND      │ Корпус
    21   │    Ucc1     │ Напряжение питания 5В +/- 5%
         │    ____     │
    22   │    TEST     │ При подаче на этот вход сигнала высокого уров-
         │             │ ня микросхема вырабатывает импульсы управления
         │             │ перемещением МГ (STEP) с повышенной частотой.
    23   │    HRDY     │ МГ в рабочем положении. Выходной сигнал,  ука-
         │             │ зывающий, что МГ готова к работе.
    24   │    CLC      │ Сигналы тактовой частоты.
    25   │    RSTB     │ Строб чтения, подтверждает прием данных от ГМД
         │             │ На выходе устанавливается напряжение  высокого
         │             │ уровня после приема двух байтов нулей при оди-
         │             │ нарной плотности записи и после приема четырех
         │             │ байтов нулей или единиц, при удвоенной плотно-
         │             │ сти записи.
  ───────┴─────────────┴───────────────────────────────────────────────
  ───────┬─────────────┬───────────────────────────────────────────────
     1   │      2      │                      3
  ───────┼─────────────┼───────────────────────────────────────────────
    26   │             │ Синхронизирующий тактовый сигнал, вырабатывае-
         │    ____     │ мый из сигналов -RAWR.
    27   │    RAWR     │ Импульсный сигнал входных данных,  считываемых
         │             │ с НГМД.
    28   │    HLD      │ Выходной сигнал, управляющий магнитной  голов-
         │             │ кой.
    29   │    TR43     │ Выходной сигнал, указывающий, что МГ находится
         │             │ между  дорожками 44...76.   Генерация  сигнала
         │             │ происходит только в процессе выполнения команд
         │             │ Запись, Считывание.
    30   │    WSTB     │ Строб записи, имеет высокий уровень  на  время
         │             │ записи информации на ГМД.
    31   │     WD      │ Сигналы записи данных на ГМД.
    32   │    CPRDY    │ Входной сигнал, указывающий на готовность НГМД
         │             │ выполнять команды Считывание или Запись.  Если
         │             │ сигнал CPRDY низкого уровня, команды  Считыва-
         │             │ ние,  Запись не выполняются  и  вырабатывается
         │             │ сигнал INTRQ. Вспомогательные команды, обеспе-
         │             │ чивающие подготовку НГМД к работе, выполняются
         │             │ независимо от состояния сигнала CPRDY.
    33   │    WF/DE    │ Двунаправленная шина, используемая для обозна-
         │             │ чения ошибки записи и размещения выбора данных
         │             │ поступающих от ЭВМ. Если сигнал  WSTB=1, вывод
         │             │ WF/DE функционирует как WF-вход.  Если  сигнал
         │             │ WF=0, запись какой-либо  команды будет  немед-
         │             │ ленно прекращена. Если сигнал WSTB=0, вывод 33
         │             │ функционирует как DE-выход.   На выходе  DE  в
         │             │ процессе чтения после загрузки МГ и  установки
         │             │ высокого уровня сигнала HRDY будет  напряжение
         │    ____     │ низкого уровня.
    34   │    TR00     │ Входной сигнал, указывающий микросхеме, что МГ
         │     __      │ установлена в исходное положение.
    35   │     JP      │ Входной сигнал с НГМД, информирующий микросхе-
         │             │ му о том, что индексный импульс считан  и  ГМД
         │    ____     │ начал очередной оборот.
    36   │    WPRT     │ Входной сигнал запрещения записи на ГМД.  Низ-
         │    ____     │ кий уровень сигнала прекращает запись.
    37   │    DDEN     │ Входной сигнал, указывающий  микросхеме, с ка-
         │             │ кой плотностью должны выполняться операции.
    38   │    DRQ      │ Выходной сигнал в режиме чтения указывает, что
         │             │ регистр данных содержит информацию для переда-
         │             │ чи. В режиме  записи  сигнал DRQ указывает  на
         │             │ готовность  приема информации  с  шины данных.
         │             │ Этот сигнал устанавливается в состояние низко-
         │             │ го уровня, если данные считаны в ЭВМ или запи-
         │             │ саны из ЭВМ в регистр данных.
    39   │    INTRQ    │ Готовность микросхемы. На этом выходе устанав-
         │             │ ливается напряжение высокого уровня,  если вы-
         │             │ полнена какая-либо команда, и напряжение  низ-
         │             │ кого уровня, если микросхема выполнила команду
         │             │ или считан регистр состояния.
    40   │     Ucc2    │ Источник питания 12В +/- 5%.
  ───────┴─────────────┴───────────────────────────────────────────────

                                Микросхема
                        ┌───────┬───────┬───────┐
               => 1 ────┤ BS    │   К   │  RSTB ├──── 25 =>
               => 2 ────┤ -W    │   Р   │   HLD ├──── 28 =>
               => 3 ────┤ -CS   │   1   │  STEP ├──── 15 =>
               => 4 ────┤ -R    │   8   │  DIRC ├──── 16 =>
               => 5 ────┤ A0    │   1   │       │
               => 6 ────┤ A1    │   8   │    WD ├──── 31 =>
                        ├───────┤   В   │       │
              => 24 ────┤ CLC   │   Г   │       │
              => 19 ────┤ -CLR  │   9   │       │
              => 22 ────┤ -TEST │   3   │       │
              => 23 ────┤ HRDY  │       │    SR ├──── 18 =>
              => 32 ────┤ CPRDY │       │       │
              => 34 ────┤ -TR00 │   D   │  TR43 ├──── 29 =>
              => 35 ────┤ -IP   │   I   │       │
                        │       │   P   │    SL ├──── 17 =>
              => 26 ────┤ S     │   4   │       │
                        │       │   0   │       │
              => 36 ────┤ WPRT  │       │       │
              => 37 ────┤ -DDEN │       │       │
                        │       │       │       │
              => 27 ────┤ -RAWR │       │       │
                        │       │       │       │
                    ────┼───────┤       │       │
              <=> 7 ────┤ DB0   │       │       │
              <=> 8 ────┤ DB1   │       │       │
              <=> 9 ────┤ DB2   │       │   DRQ ├──── 38 =>
             <=> 10 ────┤ DB3   │       │ INTRQ ├──── 39 =>
             <=> 11 ────┤ DB4   │       │ WF/DE ├──── 33 <=>
             <=> 12 ────┤ DB5   │       │       │
             <=> 13 ────┤ DB6   │       │       │
             <=> 14 ────┤ DB7   │       │  WSTB ├──── 30 =>
                        ├───────┤       │       │
                 20 ────┤ GND   │       │       │
                 21 ────┤ Ucc1  │       │       │
                 40 ────┤ Ucc2  │       │       │
                        └───────┴───────┴───────┘

    Микросхема обеспечивает прием и выполнение 11 команд. Все команды ус-
ловно разделены на четыре типа: вспомогательные, записи и чтения информа-
ции, поиска и чтения индексного поля на ГМД,  принудительного  прерывания
(табл. 3). Зависимость времени перемещения МГ от кодов Ч1, Ч0  и  состоя-
ния входного сигнала -TEST, показана в табл. 4.

    Команда Восстановление обеспечивает переход  МГ  на  нулевую  дорожку
ГМД. Если на входе TR00 нет подтверждения о выходе  на  нулевую  дорожку,
после выдачи 256 импульсов, выполнение команды прекращается.

    Команда Поиск предполагает, что РгДор содержит информацию  о  текущем
номере дорожки, а РгД - требуемой дорожки. Перемещение МГ выполняется  до
тех пор, пока содержимое РгДор не сравняется с содержимым РгД. Поиск  вы-
полняется при V=1.

    Команда Шаг обеспечивает выдачу импульса на перемещение  МГ  на  один
шаг. Направление перемещения при этом не изменяется.

    Команды Шаг вперед и Шаг назад обеспечивают выдачу сигнала DIRC (нап-
равление перемещения).

    Команды типа 2 обеспечивают  считывание  информации  с  ГМД  (рис. 3,
рис. 3 - здесь не показан) и запись  ее на ГМД.  Перед вводом этих команд
необходимо  в  РгСект  установить номер требуемого сектора. Длина сектора
задается кодом и записывается  в  индексной  области  при  форматировании
диска в соответствии с выводом, приведенным ниже.

                 ───────────────┬──────────────────────
                  Длина сектора │ Число байт в секторе
                 ───────────────┼──────────────────────
                             00 │                  128
                             01 │                  256
                             02 │                  512
                             03 │                 1024
                 ───────────────┴──────────────────────

    По командам типа 2 выполняется запись или чтение  требуемого  сектора
по заданным номерам стороны, сектора и дорожки ГМД с проверкой  индексной
адресной метки (ИАМ) и (КК). Признаки команд  этого  типа  соответственно
обозначают (см. табл. 3):
    m  -  код, указывающий на обращение к  одному  (m=0)  или  нескольким
(m=1) секторам. При m=0 после считывания (записи) одного  сектора  работа
прекращается. При m=1 после окончания работы с первым сектором  в  РгСект
прибавляется единица и начинается обработка следующего сектора. Эта  опе-
рация продолжается до тех пор, пока не будет  обработан  самый  последний
сектор на данной дорожке;
    S - код, определяющий номер стороны диска (0 или 1);
    Е - код, указывающий на выполнение задержки продолжительностью 15  мс
для установки МГ в рабочее положение после сигнала HLD (при Е=0  задержка
не осуществляется);
    С  -  код, указывающий на необходимость проверки номера стороны ГМД в
процессе идентификации индексной области (при С=0 номер стороны диска  не
проверяется);
    а0  -  код, используемый для выбора одного  из  двух  возможных  байт
признака защиты данных для записи в области ИАМ  (при  а0=1  записывается
байт F8, указывая, что данные могут стираться; при а0=0 записывается байт
FB, указывая, что область данных сохраняется).

    Контрольный код представлен в виде двух байт и вычисляется как цикли-
ческая сумма полинома:

    A = X^15 + X^12 + X^5 + 1.

    Команда Чтение сектора Выполняется, когда идентифицированы номера до-
рожки, сектора и КК (рис. 5, рис. 5 - здесь не показан).  Адресная  метка
данных должна быть установлена  через  30  байт  для одинарной и через 43
байта для двойной плотности записи после КК индексной области.  Если  ИАМ
не найдена,  вырабатывается признак  Массив  чтения  не  найден,  который
выдается в РгСост. После прохождения адресной метки байты данных вводятся
в РгСдв и передаются  в  РгД. Каждый  байт  сопровождается  сигналом  DRQ
Готовность данных. РгД должен быть считан  до  приема  следующего  байта.
Если предыдущий  байт  не  считан,  записывается  следующий, а  в  РгСост
записывается признак Потеря данных.
    В конце считывания массива данных КК должен совпадать с  генерируемым
в микросхеме. Если они не совпадают, выставляется бит Ошибка КК в  РгСост
и прекращается выполнение команды, даже при m=1.

    Команда Запись сектора выполняется подобно команде Чтение  сектора  в
части анализа индексного массива,  определения  номера  дорожки,  стороны
диска, длины сектора и вычисления КК (рис. 6, рис. 6 - здесь не показан).
Сигнал  DRQ  генерируется,  запрашивая первый байт данных, который должен
быть записан на  ГМД.  Затем  микросхема  вычисляет 11 байт при одинарной
(или 22 при двойной)  плотности  записи  для  обеспечения  пробела  между
индексной областью и данными. С  момента прохождения 11 или 22 байт (если
первый запрос  сигнала  DRQ  обслужен  и  данные записаны в РгД) выдается
строб записи WSTB и 6 байт нулей для одинарной  (или 12 байт для двойной)
плотности   записываются  на  диск.  Это  соответствует  записи  пробела,
а  затем  записывается  ИАМ.  Байт   признака   данных   может   быть  FB
(без стирания данных) или F8 (со стиранием) в соответствии с кодом а0.
    При записи данных на ГМД каждый байт заносится  в  РгД, передается  в
РгСдв и затем на диск. Сигнал DRQ вырабатывается для ЭВМ на каждый после-
дующий байт данных. Если DRQ не обслужен,  вырабатывается  сигнал  Потеря
данных в разряде S1 РгСост, а на диске записывается байт нулей. После за-
писи данных записывается КК в виде двух байт, генерируемых микросхемой, а
затем один байт FF, и устанавливается низкий уровень сигнала WSTB.

    Команды типа 3 предназначены для поиска информации на диске или запи-
си информации (форматирование диска). Структура кода  содержит  один  бит
признака, определяющего необходимость включения задержки 15 мс после сиг-
нала HLD, как и при выполнении команд типа 2.

    Команда Чтение адреса выполняется при установке МГ в рабочее  положе-
ние (HLD=1). В бит  состояния  Занято  записывается  единица.  Последова-
тельно считываются 6 байт индексной области, включая КК, и передаются  на
шину данных в сопровождении сигнала DRQ. КК считывается и  передается  на
шину данных, микросхема проверяет его, если КК не совпадает, выдается бит
состояния Ошибка КК и продолжается выполнение команды чтения. При  выпол-
нении этой команды содержимое РгДор пересылается в РгСект и запоминается.
По окончании выполнения команды генерируется сигнал INTRQ и очищается бит
состояния Занято.

    Команда Чтение дорожки обеспечивает чтение всей  информации,  включая
индексный массив, контрольные коды, пробелы и массив данных,  и  передачу
ее в ЭВМ. В процессе чтения не выдается строб  чтения  и  не  выполняется
проверка КК, что позволяет использовать данную команду в  диагностических
целях.

    Команда Запись дорожки предназначена для разметки ГМД.  Информация  в
ЭВМ для этой процедуры должна содержать все пробелы  и  индексные  метки.
Любая последовательность данных,  имеющаяся  в  ЭВМ,  записывается.  Если
появляются байты F5...FE, то они интерпретируются как адресные метки дан-
ных. Контрольный код генерируется в момент передачи байтов F8...FE из РгД
в РгСдв в режиме ЧМ или при появлении байта F5 в режиме МЧМ. При  появле-
нии кода F7 КК записывается двумя байтами. Таким образом,  байты  F5...FE
не должны записываться в местах пробелов, области  данных  или  индексных
массивах.

    Команда типа 4 Принудительное прерывание задается для завершения  ка-
кой-либо выполняемой команды. В отличие от других команд она  может  быть
записана в РгКом в любой момент времени.
    Однако исполнение команды может определяться состоянием  младших  би-
тов J0...J3. Если биты J0...J3 находятся в состоянии 0, прекращается  вы-
полнение текущей команды и сигнал INTRQ не вырабатывается. При J0=1  пре-
рывание выполняется после перехода сигнала CPRDY из низкого уровня в  вы-
сокий. J1=1 определяет прерывание при переходе CPRDY из высокого уровня в
низкий. J2=1 - прерывание по приходу индексного импульса -JP. J3=1  обес-
печивает немедленное прерывание  выполняемой  команды.  После  выполнения
этих условий вырабатывается сигнал INTRQ.
    Каждый служебный байт (табл. 5) может быть размещен в  индексной  об-
ласти в соответствии с форматом массива.  Байт  FC  определяет  индексную
метку, которая ставится перед первым индексным массивом.  FE  -  адресную
метку индексных данных, которая записывается в начале индексного массива.
F7 - код, который указывает на необходимость записи  результата  вычисле-
ний двух байтов КК.
    В табл.  6 и 7  приведены примерные форматы массивов данных,  записы-
ваемых на ГМД соответственно с одинарной и удвоенной плотностью. При  за-
писи отдельных служебных кодов ЧМ часть  синхросигналов  опускается.  При
этом наличие сигналов S определяется кодом CLK, приведенным в табл. 6.

                  Назначение битов регистра состояния

                                                              Таблица 2
 ────────┬─────────────────────────────────────────────────────────────
         │
         │                    Выполняемая команда
  Разряд ├───────────┬────────┬─────────┬─────────┬──────────┬─────────
         │ Вспомога- │ Чтение │  Чтение │  Чтение │  Запись  │  Запись
         │ тельная   │ адреса │ сектора │ дорожки │ сектора  │ дорожки
 ────────┼───────────┴────────┴─────────┴─────────┴──────────┴─────────
    7    │          Разряд, указывающий на готовность НГМД
 ────────┼───────────┬────────┬─────────┬─────────┬────────────────────
    6    │   Защита  │    0   │    0    │    0    │   Защита записи
         │   записи  │        │         │         │
 ────────┼───────────┼────────┼─────────┼─────────┼────────────────────
    5    │  Загрузка │    0   │  Запись │    0    │   Ошибка записи
         │     МГ    │        │ со стир.│         │
 ────────┼───────────┼────────┴─────────┼─────────┼───────────┬────────
    4    │   Ошибка  │ Массив не найден │    0    │ Массив не │   0
         │   поиска  │                  │         │   найден  │
 ────────┼───────────┴──────────────────┼─────────┼───────────┼────────
         │                              │         │ Ошибка в  │
    3    │   Ошибка в контрольном коде  │    0    │ контроль- │   0
         │                              │         │ ном коде  │
 ────────┼───────────┬──────────────────┴─────────┴───────────┴────────
         │   МГ в    │
    2    │ исходном  │                Потеря  данных
         │ состоянии │
 ────────┼───────────┼─────────────────────────────────────────────────
    1    │ Индексный │                Запрос  данных
         │  импульс  │
 ────────┼───────────┴─────────────────────────────────────────────────
    0    │              Занято (идет выполнение команды)
 ────────┴─────────────────────────────────────────────────────────────

                Структура команд контроллера КР1818ВГ93

                                                           Таблица 3
    ───┬────────────────┬───────────────────────────────────────────
     Т │                │            Структура кода, бит
     и │    Команда     ├───────────────────────────────────────────
     п │                │   7    6    5    4    3    2    1    0
    ───┼────────────────┼───────────────────────────────────────────
       │ Восстановление │   0    0    0    0    h    V    Ч1   Ч0
       │ Поиск          │   0    0    0    1    h    V    Ч1   Ч0
     1 │ Шаг            │   0    0    1    И    h    V    Ч1   Ч0
       │ Шаг вперед     │   0    1    0    И    h    V    Ч1   Ч0
       │ Шаг назад      │   0    1    1    И    h    V    Ч1   Ч0
    ───┼────────────────┼───────────────────────────────────────────
     2 │ Чтение сектора │   1    0    0    m    S    E    C    0
       │ Запись сектора │   1    0    1    m    S    E    C    a0
    ───┼────────────────┼───────────────────────────────────────────
       │ Чтение адреса  │   1    1    0    0    0    E    0    0
     3 │ Чтение дорожки │   1    1    1    0    0    E    0    0
       │ Запись дорожки │   1    1    1    1    0    E    0    0
    ───┼────────────────┼───────────────────────────────────────────
     4 │ Принудительное │
       │ прерывание     │   1    1    0    1    J3   J2   J1   J0
    ───┴────────────────┴───────────────────────────────────────────

     Примечание: h - код установки МГ в рабочее  положение  (при  h=0  МГ
поднята, при h=1 МГ устанавливается в рабочее положение); V - код,  опре-
деляющий необходимость проверки положения МГ (при  V=0  положение  МГ  не
проверяется, при V=1 читается и проверяется номер дорожки, на которой на-
ходится МГ); Ч1, Ч0 - коды, определяющие скорость  перемещения  МГ;  И  -
код, определяющий состояние РгДор при перемещении МГ (при  И=0  состояние
РгДор не изменяется, при И=1 на каждом шаговом импульсе  состояние  РгДор
изменяется на единицу).

          Коды установки времени перемещения магнитной головки

                                               Таблица 4
                ──────┬────┬────┬───────────────────────
                      │    │    │   Время перемешения
                 ____ │    │    │      на шаг, мс
                 TEST │ Ч1 │ Ч0 ├───────────┬───────────
                      │    │    │ CLC=1 МГц │ CLC=2 МГц
                ──────┼────┼────┼───────────┼───────────
                  1   │  0 │  0 │     6     │     3
                  1   │  0 │  1 │    12     │     6
                  1   │  1 │  0 │    20     │    10
                  1   │  1 │  1 │    30     │    15
                  0   │  - │  - │   400     │   200
                ──────┴────┴────┴───────────┴───────────

               Назначение байтов информации БИС КР1818ВГ93

                                                             Таблица 5
   ─────────┬─────────────────────────────────────────────────────────
            │                       Назначение
      Байт  ├───────────────────────────┬─────────────────────────────
     данных │ режим частотной модуляции │   режим модифицированной
            │                           │  частотной модуляции (МЧМ)
   ─────────┼───────────────────────────┼─────────────────────────────
    00...F4 │ Запись 00...F4            │ Запись 00...F4
            │ CLK=FF                    │
      F5    │ Не допускается            │ Запись А1, инициализация КК
      F6    │ Не допускается            │ Запись C2
      F7    │ Запись двух байтов КК     │ Запись двух байтов КК
    F8...FB │ Запись F8...FB            │ Запись F8...FB
            │ CLK=C7, инициализация КК  │
      FC    │ Запись FC с CLK=D7        │ Запись FC
      FD    │ Запись FD с CLK=FF        │ Запись FD
      FE    │ Запись FE                 │ Запись FE
            │ CLK=C7, инициализация КК  │
      FF    │ Запись FF с CLK=FF        │ Запись FF
   ─────────┴───────────────────────────┴─────────────────────────────

                    Форматы массивов данных в режиме
                     записи с частотной модуляцией

                                                  Таблица 6
             ──────────┬─────────┬─────────────────────────
               Число   │         │
               байтов  │   Код   │       Назначение
             ──────────┼─────────┼─────────────────────────
                40     │ FF (00) │ Пятый пробел (от начала
                       │         │ индексного импульса)
                 6     │   00    │
                 1     │   FC    │ Индексная метка
                26     │ FF (00) │ Первый пробел
                 6     │   00    │
              ─────┐   │         │
                 1 │   │   FE    │ Адресная метка индексных
                   │ О │         │ данных
                 1 │ д │   XX    │ Номер дорожки
                 1 │ и │   XX    │ Номер стороны диска
                   │ н │         │  (00 или 01)
                 1 │   │   XX    │ Номер сектора (01...1А)
                 1 │   │   XX    │ Длина сектора (00)
                 1 │ с │   F7    │ Запись двух байтов КК
                11 │ е │ FF (00) │ Второй пробел
                 6 │ к │   00    │
                 1 │ т │   FB    │ Адресная метка данных
               128 │ о │   XX    │ Данные
                 1 │ р │   F7    │ Запись двух байтов КК
                27 │   │ FF (00) │ Третий пробел
              ─────┘   │         │
               247     │ FF (00) │ Продолжение записи до
                       │         │ выдачи прерывания
                       │         │ (четвертый пробел до
                       │         │ начала индексного
                       │         │ импульса)
             ──────────┴─────────┴─────────────────────────

                Форматы массивов данных в режиме записи
                с модифицированной частотной модуляцией

                                                  Таблица 7
             ──────────┬─────────┬─────────────────────────
               Число   │         │
               байтов  │   Код   │       Назначение
             ──────────┼─────────┼─────────────────────────
                80     │   4E    │ Пятый пробел (от начала
                       │         │ индексного импульса)
                12     │   00    │
                 3     │   F6    │ Запись C2
                 1     │   FC    │ Индексная метка
              ─────┐   │         │
                50 │ О │   4E    │ Первый пробел
                12 │ д │   00    │
                 3 │ и │   F5    │ Запись A1
                 1 │ н │   FE    │ Адресная метка индексных
                   │   │         │ данных
                 1 │ с │   XX    │ Номер дорожки (0-4C)
                 1 │ е │   XX    │ Номер стороны (0 или 1)
                 1 │ к │   XX    │ Номер сектора (1-1A)
                 1 │ т │   XX    │ Длина сектора (01)
                 1 │ о │   F7    │ Запись двух байтов КК
                   │ р │         │
              ─────┘   │         │
                22     │   4E    │ Второй пробел
                12     │   00    │
                 3     │   F5    │ Запись A1
                 1     │   FB    │ Адресная метка данных
               256     │   XX    │ Данные
                 1     │   F7    │ Запись двух байтов КК
                54     │   4E    │ Третий пробел
               598     │   4E    │ Продолжение записи до
                       │         │ выдачи прерывания
                       │         │ (четвертый пробел до
                       │         │ начала индексного
                       │         │ импульса)
             ──────────┴─────────┴─────────────────────────

    "Микропроцессорные средства и системы" - номер 3 за 1986 год.
